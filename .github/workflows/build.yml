name: 构建部署
on:
  push:
    branches: [main] # 推送到 main 分支时触发（如果你的分支名不是 main，改成你的分支名，比如 master）
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. 拉取代码（用最新版工具，解决 git 报错）
      - name: 拉取仓库代码
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'
          fetch-depth: 0

      # 2. 安装 Node.js（固定 18 版本，和本地一致）
      - name: 安装 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'pnpm'

      # 3. 安装 pnpm（官方稳定方式）
      - name: 安装 pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 9

      # 4. 安装依赖（换国内镜像，下载更快）
      - name: 安装项目依赖
        run: |
          pnpm config set registry https://registry.npmmirror.com/
          pnpm install --frozen-lockfile

      # 5. 构建项目
      - name: 构建项目
        run: pnpm run build

      # 6. 部署（如果原来有部署命令，替换下面的内容；没有就保留这行注释）
      - name: 部署
        if: success()
        run: echo "部署步骤（如果需要部署，替换这里的命令）"